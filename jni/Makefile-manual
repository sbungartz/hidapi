JNI_INCLUDES = -I/usr/lib/jvm/java-1.7.0-openjdk-amd64/include/ -I/usr/lib/jvm/java-1.7.0-openjdk-amd64/include/linux

jniapi: hidapi_wrap.o hidapiswig.jar

jniapi-linux: jniapi-linux-hidraw jniapi-linux-libusb
jniapi-linux-hidraw: jniapi libhidapi-linux-raw.so
jniapi-linux-libusb: jniapi libhidapi-linux-libusb.so

libhidapi-linux-raw.so: hidapi_wrap.o
	$(MAKE) -C ../linux -f Makefile-manual clean
	$(MAKE) -C ../linux -f Makefile-manual
	ld -G ../linux/hid.o hidapi_wrap.o -ludev -o libhidapi-linux-raw.so

libhidapi-linux-libusb.so: hidapi_wrap.o
	$(MAKE) -C ../libusb -f Makefile-manual clean
	$(MAKE) -C ../libusb -f Makefile-manual
	ld -G ../libusb/hid.o hidapi_wrap.o -ludev -lusb-1.0 -o libhidapi-linux-libusb.so

swig:
	rm -rf javasrc
	mkdir -p javasrc/de/sbungartz/hidapi
	swig -c++ -java -package de.sbungartz.hidapi -outdir javasrc/de/sbungartz/hidapi hidapi.i

hidapi_wrap.o: swig
	g++ -fpic $(JNI_INCLUDES) -c hidapi_wrap.cxx

javabin:
	rm -rf javabin
	mkdir -p javabin
	javac -d javabin javasrc/de/sbungartz/hidapi/*.java

hidapiswig.jar: javabin
	jar cf0 hidapiswig.jar -C javabin .

clean:
	rm -rf javasrc
	rm -rf javabin
	rm -f hidapi_wrap.cxx hidapi_wrap.o hidapiswig.jar
	rm -f libhidapi-linux-raw.so libhidapi-linux-libusb.so
