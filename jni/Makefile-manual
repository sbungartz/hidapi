JNI_INCLUDES = -I "C:\Program Files\Java\jdk1.7.0_51\include" -I "C:\Program Files\Java\jdk1.7.0_51\include\win32"

jniapi: hidapi_wrap.o hidapi_wrap_x64.o hidapiswig.jar

jniapi-linux: jniapi-linux-hidraw jniapi-linux-libusb
jniapi-linux-hidraw: jniapi libhidapi-linux-raw.so
jniapi-linux-libusb: jniapi libhidapi-linux-libusb.so

jniapi-windows: libhidapi-win-x64.dll

libhidapi-linux-raw.so: hidapi_wrap.o
	$(MAKE) -C ../linux -f Makefile-manual clean
	$(MAKE) -C ../linux -f Makefile-manual
	ld -G ../linux/hid.o hidapi_wrap.o -ludev -o libhidapi-linux-raw.so

libhidapi-linux-libusb.so: hidapi_wrap.o
	$(MAKE) -C ../libusb -f Makefile-manual clean
	$(MAKE) -C ../libusb -f Makefile-manual
	ld -G ../libusb/hid.o hidapi_wrap.o -ludev -lusb-1.0 -o libhidapi-linux-libusb.so
	
libhidapi-win-x64.dll: hidapi_wrap_x64.o
	$(MAKE) -C ../windows -f Makefile-manual hid_x64.o
	x86_64-w64-mingw32-g++ -shared -m64 -g ../windows/hid_x64.o hidapi_wrap_x64.o -lsetupapi -o libhidapi-win-x64.dll

swig:
	rm -rf javasrc
	mkdir -p javasrc/de/sbungartz/hidapi
	swig -c++ -java -package de.sbungartz.hidapi -outdir javasrc/de/sbungartz/hidapi hidapi.i

hidapi_wrap.o: swig
	g++ -fpic $(JNI_INCLUDES) -c hidapi_wrap.cxx
hidapi_wrap_x64.o : swig
	x86_64-w64-mingw32-g++ -fpic -m64 $(JNI_INCLUDES) -c hidapi_wrap.cxx -o hidapi_wrap_x64.o

javabin:
	rm -rf javabin
	mkdir -p javabin
	javac -d javabin javasrc/de/sbungartz/hidapi/*.java

hidapiswig.jar: javabin
	jar cf0 hidapiswig.jar -C javabin .

clean:
	rm -rf javasrc
	rm -rf javabin
	rm -f hidapi_wrap.cxx hidapi_wrap.o hidapiswig.jar
	rm -f libhidapi-linux-raw.so libhidapi-linux-libusb.so
